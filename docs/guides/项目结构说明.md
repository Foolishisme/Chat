# 项目结构说明文档 📁

> 多模态RAG智能对话系统 V2.1 - 项目组织与架构说明

---

## 📊 目录结构总览

```
Chat/
├── 📁 app/                          # ✅ 应用核心代码（Python包）
│   ├── __init__.py                  # 包初始化
│   ├── __main__.py                  # 模块入口：python -m app
│   ├── main.py                      # FastAPI应用主文件
│   ├── config.py                    # 配置管理（环境变量）
│   │
│   ├── 📁 services/                 # ✅ 业务服务层
│   │   ├── __init__.py
│   │   ├── rag_service.py           # RAG核心服务
│   │   └── image_processor.py       # 图片处理服务（CLIP）
│   │
│   ├── 📁 models/                   # ✅ 数据模型层
│   │   └── __init__.py              # Pydantic模型（待扩展）
│   │
│   └── 📁 utils/                    # ✅ 工具函数层
│       └── __init__.py              # 辅助函数（待扩展）
│
├── 📁 static/                       # ✅ 前端静态资源
│   └── index.html                   # 单页应用界面
│
├── 📁 data/                         # ✅ 数据存储目录
│   ├── documents/                   # PDF文档存储
│   │   ├── 文档.pdf
│   │   └── 文档2.pdf
│   ├── images/                      # 提取的图片
│   │   ├── 文档_page1_img1.jpeg
│   │   └── ...
│   └── vector_db/                   # 向量数据库
│       ├── text_index.faiss         # 文本向量索引
│       ├── text_index.pkl
│       ├── image_index.faiss        # 图片向量索引
│       └── image_index.pkl
│
├── 📁 docs/                         # ✅ 项目文档（分类存储）
│   ├── api/                         # API文档
│   ├── guides/                      # 用户指南
│   │   ├── V2.0使用指南.txt
│   │   ├── Markdown渲染说明.md
│   │   └── 项目结构说明.md         # 本文档
│   ├── technical/                   # 技术文档
│   │   ├── 多模态RAG-CLIP方案说明.md
│   │   ├── 切片策略评估报告.txt
│   │   └── 时延分析报告.txt
│   └── development/                 # 开发文档
│       ├── 会话总结-多模态RAG升级.md
│       └── 项目需求.txt
│
├── 📁 scripts/                      # ✅ 启动脚本
│   ├── run.sh                       # Linux/Mac启动脚本
│   └── run.bat                      # Windows启动脚本
│
├── 📁 tests/                        # ✅ 测试代码
│   └── __init__.py                  # 单元测试（待扩展）
│
├── 📁 configs/                      # ✅ 配置文件
│   └── .env.example                 # 环境变量示例
│
├── .gitignore                       # Git忽略文件
├── .env                             # 环境变量（不提交）
├── README.md                        # 项目说明文档
├── requirements.txt                 # pip依赖管理
└── pyproject.toml                   # Poetry配置
```

---

## 🎯 设计原则

### 1. 分层架构（Layered Architecture）

```
用户界面层 (Presentation Layer)
    ↓
Web服务层 (API Layer)
    ↓
业务逻辑层 (Service Layer)
    ↓
数据访问层 (Data Layer)
```

### 2. 职责分离（Separation of Concerns）

| 目录 | 职责 | 示例 |
|------|------|------|
| `app/` | 应用核心代码 | FastAPI应用、配置 |
| `app/services/` | 业务逻辑 | RAG服务、图片处理 |
| `app/models/` | 数据模型 | Pydantic模型 |
| `app/utils/` | 工具函数 | 辅助函数、常量 |
| `static/` | 前端资源 | HTML/CSS/JS |
| `data/` | 数据存储 | 文档、向量库 |
| `docs/` | 文档管理 | 分类文档 |
| `scripts/` | 工具脚本 | 启动、部署脚本 |
| `tests/` | 测试代码 | 单元测试、集成测试 |
| `configs/` | 配置管理 | 环境变量 |

### 3. 模块化（Modularity）

每个模块都是独立的 Python 包，可以单独导入和测试：

```python
# 导入配置
from app.config import settings

# 导入服务
from app.services.rag_service import rag_service
from app.services.image_processor import create_image_processor

# 导入模型（待扩展）
from app.models.schemas import QuestionRequest
```

---

## 📂 核心目录详解

### app/ - 应用核心

**作用**：包含所有 Python 业务代码

**文件说明**：

| 文件 | 作用 | 导入方式 |
|------|------|----------|
| `__init__.py` | 包初始化 | - |
| `__main__.py` | 模块入口 | `python -m app` |
| `main.py` | FastAPI应用 | `from app.main import app` |
| `config.py` | 配置管理 | `from app.config import settings` |

**子目录**：

- **services/**：业务服务层，核心功能实现
  - `rag_service.py`：RAG核心服务（文档加载、向量化、检索）
  - `image_processor.py`：图片处理（CLIP向量化）

- **models/**：数据模型层（Pydantic）
  - 待扩展：请求/响应模型、数据库模型

- **utils/**：工具函数层
  - 待扩展：通用辅助函数

### static/ - 前端资源

**作用**：存放前端静态文件

**访问方式**：
- Web界面：`http://localhost:8000/`
- 静态资源：`http://localhost:8000/static/`

### data/ - 数据存储

**作用**：存储应用数据（不提交到 Git）

**子目录**：

| 目录 | 作用 | 自动生成 |
|------|------|----------|
| `documents/` | PDF文档存储 | ❌ 手动上传 |
| `images/` | 提取的图片 | ✅ 自动生成 |
| `vector_db/` | 向量数据库 | ✅ 自动生成 |

### docs/ - 项目文档

**作用**：分类存储项目文档

**分类说明**：

| 目录 | 文档类型 | 示例 |
|------|----------|------|
| `api/` | API文档 | 接口设计、OpenAPI规范 |
| `guides/` | 用户指南 | 使用教程、功能说明 |
| `technical/` | 技术文档 | 技术方案、性能测试 |
| `development/` | 开发文档 | 需求文档、开发日志 |

### scripts/ - 启动脚本

**作用**：提供便捷的启动方式

**使用方法**：

```bash
# Linux/Mac
bash scripts/run.sh

# Windows
scripts\run.bat
```

**脚本功能**：
1. 自动切换到项目根目录
2. 检查并创建虚拟环境
3. 安装依赖
4. 启动应用

### tests/ - 测试代码

**作用**：单元测试、集成测试

**运行测试**：

```bash
# 运行所有测试
pytest

# 运行特定测试
pytest tests/test_rag_service.py

# 查看覆盖率
pytest --cov=app tests/
```

### configs/ - 配置文件

**作用**：集中管理配置文件

**文件**：

| 文件 | 作用 | 提交到Git |
|------|------|-----------|
| `.env.example` | 环境变量示例 | ✅ 提交 |
| `.env` | 实际环境变量 | ❌ 不提交 |

---

## 🔄 导入路径规则

### 绝对导入（推荐）

```python
# ✅ 推荐：使用绝对导入
from app.config import settings
from app.services.rag_service import rag_service
from app.services.image_processor import create_image_processor
```

### 相对导入（慎用）

```python
# ⚠️ 仅在同一包内使用
# 在 app/services/rag_service.py 中：
from .image_processor import create_image_processor
```

---

## 🚀 启动方式

### 方式一：使用脚本（推荐）

```bash
# Linux/Mac
bash scripts/run.sh

# Windows
scripts\run.bat
```

### 方式二：模块方式

```bash
python -m app
```

### 方式三：直接运行

```bash
python -m app.main
```

### 方式四：Uvicorn

```bash
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

---

## 📝 开发规范

### 文件命名

- **Python文件**：小写+下划线，如 `rag_service.py`
- **类名**：大驼峰，如 `RAGService`
- **函数名**：小写+下划线，如 `load_document`
- **常量**：大写+下划线，如 `MAX_HISTORY`

### 目录规范

- **包目录**：必须包含 `__init__.py`
- **数据目录**：添加到 `.gitignore`
- **文档目录**：按类型分类存储

### 导入顺序

```python
# 1. 标准库
import os
import json

# 2. 第三方库
from fastapi import FastAPI
from langchain_google_genai import ChatGoogleGenerativeAI

# 3. 本地模块
from app.config import settings
from app.services.rag_service import rag_service
```

---

## 🔧 扩展指南

### 添加新服务

1. 在 `app/services/` 创建文件：`new_service.py`
2. 定义服务类：
   ```python
   class NewService:
       def __init__(self):
           pass
       
       def method(self):
           pass
   
   new_service = NewService()
   ```
3. 在 `app/main.py` 中导入：
   ```python
   from app.services.new_service import new_service
   ```

### 添加新模型

1. 在 `app/models/` 创建文件：`schemas.py`
2. 定义 Pydantic 模型：
   ```python
   from pydantic import BaseModel
   
   class UserRequest(BaseModel):
       name: str
       email: str
   ```

### 添加新端点

在 `app/main.py` 中添加：

```python
@app.post("/new-endpoint")
async def new_endpoint():
    return {"message": "Hello"}
```

---

## 🎓 最佳实践

### 1. 保持目录整洁

- ✅ 代码放在 `app/`
- ✅ 文档放在 `docs/`
- ✅ 数据放在 `data/`
- ❌ 不要在根目录堆积文件

### 2. 分离关注点

- 业务逻辑 → `app/services/`
- 数据模型 → `app/models/`
- 工具函数 → `app/utils/`

### 3. 模块化设计

- 每个服务独立成文件
- 避免循环导入
- 使用依赖注入

### 4. 文档同步

- 代码更新时更新文档
- 文档按类型分类存储
- 重要变更记录在 README

---

## 📊 重组前后对比

### 重组前（混乱结构）

```
Chat/
├── main.py                  ❌ 混在根目录
├── rag_service.py           ❌ 混在根目录
├── image_processor.py       ❌ 混在根目录
├── config.py                ❌ 混在根目录
├── 文档.pdf                  ❌ 混在根目录
├── 文档2.pdf                 ❌ 混在根目录
├── run.sh                   ❌ 混在根目录
├── run.bat                  ❌ 混在根目录
├── env.example              ❌ 混在根目录
├── chroma_db/               ❌ 命名不统一
└── docs/                    ❌ 文档未分类
```

### 重组后（清晰结构）

```
Chat/
├── app/                     ✅ 代码分层清晰
│   ├── main.py
│   ├── config.py
│   └── services/
│       ├── rag_service.py
│       └── image_processor.py
├── data/                    ✅ 数据集中管理
│   ├── documents/
│   ├── images/
│   └── vector_db/
├── docs/                    ✅ 文档分类存储
│   ├── guides/
│   ├── technical/
│   └── development/
├── scripts/                 ✅ 脚本独立目录
│   ├── run.sh
│   └── run.bat
└── configs/                 ✅ 配置独立管理
    └── .env.example
```

---

## 🎯 总结

### 优势

1. **清晰的分层**：前端、后端、数据、文档分离
2. **易于维护**：每个模块职责明确
3. **便于扩展**：新增功能有明确的位置
4. **符合规范**：遵循Python最佳实践
5. **团队协作**：结构清晰，易于理解

### 适用场景

- ✅ Python Web 应用
- ✅ LLM/AI 应用
- ✅ FastAPI 项目
- ✅ 多人协作项目
- ✅ 需要长期维护的项目

---

<div align="center">

**📚 持续更新 | 🚀 保持整洁 | 💡 遵循规范**

*本文档随项目结构演进而更新*

</div>

